C51 COMPILER V9.60.0.0   UART                                                              04/17/2023 16:55:01 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN ..\Objects\uart.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\Modules\uart.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\System;..\Modules;.
                    -.\User) DEBUG OBJECTEXTEND PRINT(..\Listings\uart.lst) OBJECT(..\Objects\uart.obj)

line level    source

   1          #include "uart.h"
   2          #include "str.h"
   3          #include "pwm.h"
   4          
   5          u8 FunctionCode;
   6          
   7          void UART1_Init(u32 brt)
   8          {
   9   1          u32 temp = 0;
  10   1          P3M0 &= ~(0x03 << 0);
  11   1          P3M1 &= ~(0x03 << 0);  //PxM0与PxM1共同配置IO状态
  12   1          SCON |= (0x05 << 4);  //常用0x40，基本不用修改
  13   1          SCON &= ~(0x01 << 7);
  14   1          TMOD &= ~(0x07 << 4);  //设置定时器为定时模式
  15   1          AUXR |= (0x01 << 6);  //将定时器1作为串口发生器
  16   1          temp = FOSC / brt / 4;
  17   1          temp = 65536ul - temp;
  18   1          TL1 = temp;
  19   1          TH1 = temp >> 8;
  20   1          IPH |= (0x01 << 4);
  21   1          PS = 1;
  22   1          ES = 1;
  23   1          EA = 1;
  24   1          TR1 = 1;
  25   1      }
  26          
  27          void UART1_SendByte(u8 dat)
  28          {
  29   1          SBUF = dat;
  30   1          while(!TI);
  31   1          TI = 0;
  32   1      }
  33          
  34          void URAT1_PrintText(u8* str)
  35          {
  36   1          for(; *str != 0; str++)
  37   1              UART1_SendByte(*str);
  38   1      }
  39          
  40          
  41          void UART1_Int(void) interrupt 4
  42          {
  43   1          static u8 cnt = 0;
  44   1          if(RI)
  45   1          {
  46   2              RI = 0;
  47   2              switch(cnt){
  48   3                  case 0: if(SBUF == 0x55) cnt++;
  49   3                          break;
  50   3                  case 1: if(SBUF == 0xaa) cnt++;
  51   3                          else cnt = 0;
  52   3                          break;
  53   3                  case 2: FunctionCode = SBUF; cnt++;
  54   3                          break;
C51 COMPILER V9.60.0.0   UART                                                              04/17/2023 16:55:01 PAGE 2   

  55   3                  case 3: PWM0_Value = SBUF; cnt++;
  56   3                          break;
  57   3                  case 4: PWM1_Value = SBUF; cnt = 0;
  58   3                          break;
  59   3                  default: cnt = 0;
  60   3                          break;
  61   3              }
  62   2          }
  63   1      }
  64          
  65          void SendData(void) {
  66   1          
  67   1      }
  68          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    232    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
